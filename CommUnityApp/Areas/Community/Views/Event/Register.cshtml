@{
    ViewData["Title"] = "Event Registration";
    Layout = null;
}

<!DOCTYPE html>
<html>
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Event Registration</title>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
          rel="stylesheet" />

    <style>

        body {
            background: linear-gradient(180deg, #f8fafc, #f1f5f9);
            font-family: "Inter", "Segoe UI", sans-serif;
            padding-bottom: 40px;
        }

        .registration-card {
            border: none;
            border-radius: 24px;
            box-shadow: 0 25px 50px rgba(0,0,0,.06);
            overflow: hidden;
            background: #ffffff;
        }

        /* ===== Light Gray Header ===== */
        .event-header {
            background: linear-gradient(135deg, #d1d5db, #9ca3af);
            color: #1f2937;
            padding: 30px;
            text-align: center;
        }

            .event-header h3 {
                font-weight: 700;
                margin-bottom: 5px;
            }

            .event-header small {
                opacity: .9;
            }

        .form-section {
            padding: 30px;
        }

        .form-control {
            border-radius: 14px;
            padding: 12px;
            border: 1px solid #e5e7eb;
            transition: 0.2s;
        }

            .form-control:focus {
                border-color: #9ca3af;
                box-shadow: 0 0 0 3px rgba(156,163,175,.25);
            }

        label {
            font-weight: 600;
            margin-bottom: 6px;
            color: #374151;
        }

        .counter-box {
            display: flex;
            align-items: center;
            justify-content: space-between;
            border: 1px solid #e5e7eb;
            border-radius: 14px;
            padding: 8px 12px;
            background: #f9fafb;
        }

        .counter-btn {
            background: #9ca3af;
            color: white;
            border: none;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            font-weight: bold;
            transition: .2s;
        }

            .counter-btn:hover {
                background: #6b7280;
            }

        /* ===== Light Gray Register Button ===== */
        .btn-register {
            width: 100%;
            border-radius: 40px;
            padding: 14px;
            font-weight: 700;
            font-size: 16px;
            background: linear-gradient(135deg, #9ca3af, #6b7280);
            border: none;
            color: #ffffff;
            margin-top: 20px;
            transition: all .3s ease;
        }

            .btn-register:hover {
                background: linear-gradient(135deg, #6b7280, #4b5563);
                box-shadow: 0 12px 30px rgba(107,114,128,.35);
                transform: translateY(-2px);
            }

        .success-box {
            margin-top: 20px;
        }

    </style>

</head>

<body>
    <div class="container mt-4">
    <div class="card event-card mb-4">
        <div class="card-body">
                <div class="mb-4 text-center">
                    <h3 class="fw-bold">Event Registration</h3>
                    <hr style="width:80px; margin:auto; border:2px solid #0d6efd;">
                    <p class="text-muted mb-0">
                        Fill the details to confirm your booking
                    </p>
                </div>

    <div class="form-section">
        <input type="hidden" id="EventId" value="@ViewBag.EventId" />

        <div class="mb-3">
            <label>Select Event Date</label>
            <input type="date" id="SelectedDate" class="form-control" />
        </div>

        <div class="mb-3">
            <label>Full Name</label>
            <input type="text" id="Name" class="form-control" placeholder="Enter your name" />
        </div>

        <div class="mb-3">
            <label>Email</label>
            <input type="email" id="Email" class="form-control" placeholder="Enter your email" />
        </div>

        <div class="mb-3">
            <label>Mobile</label>
            <input type="text" id="Mobile" class="form-control" placeholder="Enter your mobile number" />
        </div>

        <div class="mb-3">
            <label>No. of Adults</label>
            <div class="counter-box">
                <button class="counter-btn" onclick="changeCount('adult', -1)">-</button>
                <span id="NoOfAdults">1</span>
                <button class="counter-btn" onclick="changeCount('adult', 1)">+</button>
            </div>
        </div>

        <div class="mb-3">
            <label>No. of Children</label>
            <div class="counter-box">
                <button class="counter-btn" onclick="changeCount('child', -1)">-</button>
                <span id="NoOfChildren">0</span>
                <button class="counter-btn" onclick="changeCount('child', 1)">+</button>
            </div>
        </div>

        <!-- SUMMARY BOX -->
        <div class="card p-3 bg-light mt-3">
            <div><strong>Total Tickets:</strong> <span id="TotalTickets">1</span></div>
            <div><strong>Price Per Ticket:</strong> $<span id="TicketPrice">0</span></div>
            <div><strong>Total Price:</strong> $<span id="TotalPrice">0</span></div>
        </div>

        <button class="btn btn-register" onclick="registerEvent()">
            Confirm Registration
        </button>

        <div id="msg" class="success-box"></div>

    </div>
            </div>
        </div>
    </div>

    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script>

        let adults = 1;
        let children = 0;
        let ticketPrice = 0;

        $(document).ready(function () {
            loadEventPrice();
        });

        function loadEventPrice() {

            let eventIdVal = $("#EventId").val();

            if (!eventIdVal || isNaN(eventIdVal)) {
                console.log("Invalid EventId");
                return;
            }

            $.get(`/api/Event/GetEventDetails/${eventIdVal}`, function (res) {

                ticketPrice = res.ticketPrice ? Number(res.ticketPrice) : 0;

                $("#TicketPrice").text(ticketPrice.toFixed(2));
                calculateTotals();
            });
        }

        function changeCount(type, value) {

            if (type === 'adult') {
                adults = Math.max(1, adults + value);
                $("#NoOfAdults").text(adults);
            } else {
                children = Math.max(0, children + value);
                $("#NoOfChildren").text(children);
            }

            calculateTotals();
        }

        function calculateTotals() {

            let totalTickets = adults + children;
            let totalPrice = totalTickets * ticketPrice;

            $("#TotalTickets").text(totalTickets);
            $("#TotalPrice").text(totalPrice.toFixed(2));
        }

        function registerEvent() {

            let eventIdVal = $("#EventId").val();

            if (!eventIdVal || isNaN(eventIdVal)) {
                alert("Invalid event.");
                return;
            }

            let selectedDate = $("#SelectedDate").val();
            if (!selectedDate) {
                alert("Please select event date");
                return;
            }

            let name = $("#Name").val().trim();
            let mobile = $("#Mobile").val().trim();
            let email = $("#Email").val().trim();

            if (!name || !mobile) {
                alert("Name and Mobile are required");
                return;
            }

            let data = {
                eventId: Number(eventIdVal),  
                name: name,
                email: email,
                mobile: mobile,
                noOfAdults: adults,
                noOfChildren: children
            };

            $.ajax({
                url: "/api/Event/Register",
                type: "POST",
                contentType: "application/json",
                data: JSON.stringify(data),
                success: function (res) {

                    if (res.resultId > 0) {
                        $("#msg").html(
                            `<div class="alert alert-success">
                                ${res.resultMessage}
                             </div>`
                        );
                    } else {
                        $("#msg").html(
                            `<div class="alert alert-warning">
                                ${res.resultMessage}
                             </div>`
                        );
                    }
                },
                error: function (xhr) {

                    console.log(xhr.responseText);

                    $("#msg").html(
                        `<div class="alert alert-danger">
                            Registration failed
                         </div>`
                    );
                }
            });
        }

    </script>


</body>
</html>
